# Mutational antigenic profiling of 1-18
### Adam S. Dingens, Jesse Bloom
### In collaboration with Florian Klein's group, particularly Philipp Schommers and Henning Gruell.

We are performing mutational antigenic profiling of 1-18, using the BG505.T332N mutant Env libraries, first described and characterized in [Haddox, Dingens et al 2018](https://elifesciences.org/articles/34420). The triplicate mutant libraries examined here correspond to the three BG505 replicates in this paper. Replicates annotated with an additional letter (i.e. "rep 1b") were done on an independent day and have their own mock selected control. 

The _fraction surviving_ statistic used in this analysis is explained in detail [here](https://jbloomlab.github.io/dms_tools2/fracsurvive.html). Our first mutational antigenic profiling analysis of escape from PGT151 using the BF520 env libraries was published [here](http://dx.doi.org/10.1016/j.chom.2017.05.003) in June 2017, and this original analysis is located [in this Github repository](https://github.com/adingens/BF520_MutationalAntigenicProfiling_PGT151).

We use [dms_tools2](https://jbloomlab.github.io/dms_tools2/) to analyze these data. This notebook processes the Illumina deep sequencing data software package, and then analyzes the selection in the context of the antibody. Experiments and analysis performed by Adam Dingens in the [Bloom lab](http://research.fhcrc.org/bloom/en.html) in early 2019. 

## Running the analysis
The main analysis is performed by the Jupyter notebook [analysis_notebook.ipynb](analysis_notebook.ipynb).

To run [analysis_notebook.ipynb](analysis_notebook.ipynb) and generate the [Markdown results](results/analysis_notebook.md), run the bash script [run_notebook.bash](run_notebook.bash) with:

    ./run_notebook.bash

On the Hutch cluster, you probably want to submit this job using [slurm](https://slurm.schedmd.com/), which you can simply do with:

    sbatch -p largenode -c 16 --mem=100000 run_notebook.bash


## Organization
The mutational antigenic profiling analysis is performed by the iPython notebook [`analysis_notebook.ipynb`](analysis_notebook.ipynb).

Subdirectories:

   * [./results/](results) is generated by [`analysis_notebook.ipynb`](analysis_notebook.ipynb). It includes:

    - [./results/codoncounts](results/codoncounts): counts of each amino-acid mutation in each sample from the deep sequencing, in sequential numbering of BG505 Env.

    - [./results/renumberedcounts](results/renumberedcounts): counts of each amino-acid mutation in each sample from the deep sequencing, in HXB2 numbering.

    - [./results/fracsurviveaboveavg](results/fracsurviveaboveavg): the fraction surviving above the library average ("excess fraction surviving") at each site for each antibody selection.

    - [./results/fracsurvive](results/fracsurvive): the fraction surviving at each site for each antibody selection.
   
   * [./data/](data) contains all input data needed to run [`analysis_notebook.ipynb`](analysis_notebook.ipynb). Files are described in [`analysis_notebook.ipynb`](analysis_notebook.ipynb) when used. 


## Results and Conclusions
All of the results are breifly detailed in the [`analysis_notebook.ipynb`](analysis_notebook.ipynb) notebook.
Click on that notebook or its [Markdown rendering](results/analysis_notebook.md) to see the results.
